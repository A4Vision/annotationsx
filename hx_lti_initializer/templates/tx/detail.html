<!DOCTYPE html>
{% load staticfiles %}
{% load list_of_ids %}
<script src="{% static "vendors/development/jquery-1.9.1.js" %}"></script>
<script src="{% static "vendors/development/underscore.js" %}"></script>
<script src="{% static "vendors/development/jquery.timeago.js" %}"></script>
<script src="{% static "vendors/development/jstz.js" %}"></script>
<script src="{% static "vendors/development/json2.js" %}"></script>
<link rel="stylesheet" href="{% static "vendors/Annotator/annotator.css" %}">
{# Load the tag library #}
{% load bootstrap3 %}

{# Load CSS and JavaScript #}
{% bootstrap_css %}
{% bootstrap_javascript %}

{# Display django.contrib.messages as Bootstrap alerts #}
{% bootstrap_messages %}
<script src="{% static "vendors/development/bootstrap-confirmation.js" %}"></script>
<script src="{% static "vendors/development/summernote.js" %}"></script>
<!--<script src="{% static "vendors/tinymce/tinymce.min.js" %}"></script>-->
<script src="{% static "vendors/Annotator/annotator-full.js" %}"></script>
<script src="{% static "AController.js" %}"></script>
<script src="{% static "AnnotationMain.js" %}"></script>
<script src="{% static "AnnotationCore.js" %}"></script>
<script src="{% static "AnnotationStoreController.js" %}"></script>
<script src="{% static "DashboardController.js" %}"></script>
<script src="{% static "DashboardView.js" %}"></script>
<script src="{% static "TargetObjectController.js" %}"></script>
<script src="{% static "vendors/Annotator/plugins/summernote-richtext-annotator.js" %}"></script>
<script src="{% static "vendors/development/jquery.tokeninput.js" %}"></script>
<script src="{% static "vendors/Annotator/plugins/highlightTags-annotator.js" %}"></script>
<!--<script src="{% static "vendors/Annotator/plugins/richText-annotator.js" %}"></script>
<script src="{% static "vendors/Annotator/plugins/grouping-annotator.js" %}"></script>
<script src="{% static "vendors/Annotator/plugins/annotator.touch.js" %}"></script>-->
<script src="{% static "vendors/Annotator/plugins/reply-annotator.js" %}"></script>
<link rel="stylesheet" href="{% static "vendors/development/css/summernote.css" %}">
<link rel="stylesheet" href="{% static "vendors/development/css/font-awesome.css" %}">
<link rel="stylesheet" href="{% static "vendors/Annotator/plugins/summernote-richtext-annotator.css" %}">
<link rel="stylesheet" href="{% static "css/dashboard.css" %}">
<link rel="stylesheet" href="{% static "css/instructions.css" %}">
<!--<link rel="stylesheet" href="{% static "vendors/catch/main.css" %}">
<link rel="stylesheet" href="{% static "vendors/Annotator/plugins/richText-annotator.css" %}">
<link rel="stylesheet" href="{% static "vendors/Annotator/plugins/grouping-annotator.css" %}">
<link rel="stylesheet" href="{% static "vendors/Annotator/plugins/annotator.touch.css" %}">-->
<link rel="stylesheet" href="{% static "vendors/development/css/token-input.css" %}">
<link rel="stylesheet" href="{{ custom_css }}">
<div  id="viewer" class="test" style="padding-left:75px;padding-right:75px;" class="fit-to-canvas">
	<div class="annotations-status on"><i class="fa fa-close"></i> <span class="hover-inst hidden">Hide Annotations</span></div>
		<div class="row">
			<div class="navigation">
	                <a href="{% url 'hx_lti_initializer:course_admin_hub' %}">Home</a>
	        </div>
	  		<div class="col-xs-7" id="leftCol">
	        <div class="instructions-container" style="display:{% if instructions %}block{% else %}none{% endif %};">
	    			<div class="instructions-title">
	    				Instructions
	    				<span href="#" class="toggle-instructions" data-toggle="collapse" data-target=".instructions-body">Collapse Instructions</span>
	    			</div>
			</div>
			<div class="instructions-body collapse in" aria-expanded="true">{{instructions | safe}}</div>
		</div>
		{% endif %}
		<h1>{{ target_object.target_title | safe }}</h1>
		{% if target_object.target_author != "None" %}
		<h3>by {{ target_object.target_author | safe }}</h3>
		{% endif %}
		<div class="content">
		{{ target_object.target_content | safe }}
		</div>
		{% if target_object.target_citation != "None" %}
		<div class="citation" style="margin-top:20px;">
		<i>{{ target_object.target_citation }}</i>
		</div>
		{% endif %}
		{% if prev_object %}
		<a href="{% url 'hx_lti_initializer:access_annotation_target' course_id=course assignment_id=collection object_id=prev_object.target_object.id %}" style="float:left;margin-bottom:20px;" class="btn btn-primary" role="button"><i class="glyphicon glyphicon-chevron-left"></i> Previous</a>
		{% endif %}
		{% if next_object %}
		<a href="{% url 'hx_lti_initializer:access_annotation_target' course_id=course assignment_id=collection object_id=next_object.target_object.id %}" style="float:right;margin-bottom:20px;" class="btn btn-primary" role="button">Next <i class="glyphicon glyphicon-chevron-right"></i></a><br />
		{% endif %}
</div>
<div id="dashboard" class="annotationListContainer">
</div>
<script>
jQuery(function ($) {
    $(function() {
		var options = {
			commonInfo: {
				mediaType: "text", // {{ media_type }}
				context_id: "{{ course }}",
				collection_id: "{{ collection }}",
				object_id: {{ object }},
				token: "{{ token }}",
				username: "{{ username }}",
				user_id: "{{ user_id }}",
				is_instructor: "{{ is_instructor }}",
				pagination: {{ assignment.pagination_limit }},
			},
			annotationMainOptions: {
				{% if assignment.allow_highlights %}
				'highlightTags_options': "{{ assignment.highlights_options }}",
				{% endif %}
			},
			annotationCoreOptions: {
				annotationElement: jQuery(".content"),
				initOptions: {
					'plugins': [
						// order matters, auth before store
						'Auth',
						'Permissions',
						'Store',
						'SummernoteRichText',
						{% if assignment.allow_highlights %}
						'HighlightTags',
						{% endif %}
						//'RichText',
						'Reply',
						//'Touch',
					],
					'database_url': "/lti_init/annotation_api",
					'citation': "{{ target_object.target_citation | escapejs }}",
					{% if assignment.allow_highlights %}
					'highlightTags_options': "{{ assignment.highlights_options }}",
					{% endif %}
				},
			},
			targetObjectOptions: {
			},
			dashboardControllerOptions: {
				annotationElement: jQuery("#dashboard"),
				initOptions: {
					template_urls: '{% static "templates/dashboard/"%}',
					showPublicPrivateSelectors: true,
					showMediaSelector: false,
					flags: false,
					imageRootUrl: "{% static "vendors/catch/img"%}",
					instructors: {{ assignment.course.course_admins| list_of_ids | safe}},
					default_tab: "{{ assignment.default_tab }}",
					instructions: "{{instructions | escapejs }}",
					dashboard_hidden: {{dashboard_hidden}},
				},
			},
		}
		AController(options);
		if (typeof Annotator.Plugin["Grouping"] === 'function') {
			options = {
	    		optionsOVA: {
		    		posBigNew: 'none',
		    		default_tab: 'Public',
		    		annotation_tool: AController.annotationCore.annotation_tool,
		    	}
	    	}
            AController.annotationCore.annotation_tool.addPlugin("Grouping", options);
		}
	});
});
</script>
<script type="text/javascript">
	jQuery('.toggle-instructions').click(function (){
		if (jQuery('.toggle-instructions').html() == "Collapse Instructions") {
			jQuery('.toggle-instructions').html('Expand Instructions');
		} else {
			jQuery('.toggle-instructions').html('Collapse Instructions');
		}
	});
	// Sends a message to canvas to resize the iframe so we don't have scrolling issues
    $(document).ready(function() {
        var receiver = "https://canvas.harvard.edu";
        var message = {
            subject: "lti.frameResize",
            height: $(".fit-to-canvas").height()
        };
        console.log("sending message to receiver: ", message, receiver);
        window.parent.postMessage(JSON.stringify(message), receiver);
    }, 1000);
	jQuery('.annotations-status').hover(function() {
	    jQuery('.hover-inst').toggleClass("hidden");
	});
	jQuery('.annotations-status').click(function() {
		AController.targetObjectController.toggleAnnotations();
	})
</script>

